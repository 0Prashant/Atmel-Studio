<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- saved from url=(0078)http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/ -->
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US"><head profile="http://gmpg.org/xfn/11"><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">


<title>Improving the Beginner’s PID: Direction «  Project  Blog</title>

<link rel="stylesheet" href="./Improving the Beginner’s PID_ Direction « Project Blog_files/style.css" type="text/css" media="screen">
<link rel="alternate" type="application/rss+xml" title="Project  Blog RSS Feed" href="http://brettbeauregard.com/blog/feed/">
<link rel="alternate" type="application/atom+xml" title="Project  Blog Atom Feed" href="http://brettbeauregard.com/blog/feed/atom/">
<link rel="pingback" href="http://brettbeauregard.com/blog/xmlrpc.php">

<style type="text/css" media="screen">

	#page { background: url("http://brettbeauregard.com/blog/wp-content/themes/default/images/kubrickbgwide.jpg") repeat-y top; border: none; }

</style>



            <script type="text/javascript" async="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/ga.js.download"></script><script type="text/javascript">//<![CDATA[
            // Google Analytics for WordPress by Yoast v4.3.3 | http://yoast.com/wordpress/google-analytics/
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-9013272-1']);
				            _gaq.push(['_trackPageview']);
            (function () {
                var ga = document.createElement('script');
                ga.type = 'text/javascript';
                ga.async = true;
                ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';

                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(ga, s);
            })();
            //]]></script>
			<link rel="alternate" type="application/rss+xml" title="Project  Blog » Improving the Beginner’s PID: Direction Comments Feed" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/feed/">
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/brettbeauregard.com\/blog\/wp-includes\/js\/wp-emoji-release.min.js?ver=4.5.10"}};
			!function(a,b,c){function d(a){var c,d,e,f=b.createElement("canvas"),g=f.getContext&&f.getContext("2d"),h=String.fromCharCode;if(!g||!g.fillText)return!1;switch(g.textBaseline="top",g.font="600 32px Arial",a){case"flag":return g.fillText(h(55356,56806,55356,56826),0,0),f.toDataURL().length>3e3;case"diversity":return g.fillText(h(55356,57221),0,0),c=g.getImageData(16,16,1,1).data,d=c[0]+","+c[1]+","+c[2]+","+c[3],g.fillText(h(55356,57221,55356,57343),0,0),c=g.getImageData(16,16,1,1).data,e=c[0]+","+c[1]+","+c[2]+","+c[3],d!==e;case"simple":return g.fillText(h(55357,56835),0,0),0!==g.getImageData(16,16,1,1).data[0];case"unicode8":return g.fillText(h(55356,57135),0,0),0!==g.getImageData(16,16,1,1).data[0]}return!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g,h,i;for(i=Array("simple","flag","unicode8","diversity"),c.supports={everything:!0,everythingExceptFlag:!0},h=0;h<i.length;h++)c.supports[i[h]]=d(i[h]),c.supports.everything=c.supports.everything&&c.supports[i[h]],"flag"!==i[h]&&(c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&c.supports[i[h]]);c.supports.everythingExceptFlag=c.supports.everythingExceptFlag&&!c.supports.flag,c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.everything||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script><script src="./Improving the Beginner’s PID_ Direction « Project Blog_files/wp-emoji-release.min.js.download" type="text/javascript"></script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel="stylesheet" id="thingiverse_style-css" href="./Improving the Beginner’s PID_ Direction « Project Blog_files/style(1).css" type="text/css" media="all">
<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/jquery.js.download"></script>
<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/jquery-migrate.min.js.download"></script>
<link rel="https://api.w.org/" href="http://brettbeauregard.com/blog/wp-json/">
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://brettbeauregard.com/blog/xmlrpc.php?rsd">
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://brettbeauregard.com/blog/wp-includes/wlwmanifest.xml"> 
<link rel="prev" title="Improving the Beginner’s PID:  Initialization" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-initialization/">
<link rel="next" title="How Fast is the Arduino PID Library?" href="http://brettbeauregard.com/blog/2011/04/how-fast-is-the-arduino-pid-library/">
<meta name="generator" content="WordPress 4.5.10">
<link rel="canonical" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/">
<link rel="shortlink" href="http://brettbeauregard.com/blog/?p=1187">
<link rel="alternate" type="application/json+oembed" href="http://brettbeauregard.com/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginners-pid-direction%2F">
<link rel="alternate" type="text/xml+oembed" href="http://brettbeauregard.com/blog/wp-json/oembed/1.0/embed?url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginners-pid-direction%2F&amp;format=xml">
<link rel="payment" type="text/html" title="Flattr this!" href="https://flattr.com/submit/auto?user_id=br3ttb&amp;popout=1&amp;url=http%3A%2F%2Fbrettbeauregard.com%2Fblog%2F2011%2F04%2Fimproving-the-beginners-pid-direction%2F&amp;language=en_GB&amp;category=text&amp;title=Improving+the+Beginner%26%238217%3Bs+PID%3A+Direction&amp;description=Project+updates+and...+um...&amp;tags=Arduino%2CBeginner%27s+PID%2CPID%2Cblog">
<link rel="stylesheet" type="text/css" href="./Improving the Beginner’s PID_ Direction « Project Blog_files/shCore.css"><link rel="stylesheet" type="text/css" href="./Improving the Beginner’s PID_ Direction « Project Blog_files/shThemeDefault.css"><style type="text/css" id="syntaxhighlighteranchor"></style>
</head>
<body>
<div id="page">


<div id="header">
	<div id="headerimg">
		<h1><a href="http://brettbeauregard.com/blog/">Project  Blog</a></h1>
		<div class="description">Project updates and… um…</div>
	</div>
</div>
<hr>

	<div id="content" class="narrowcolumn">

	
		<div class="navigation">
			<div class="alignleft">« <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginner%e2%80%99s-pid-initialization/" rel="prev">Improving the Beginner’s PID:  Initialization</a></div>
			<div class="alignright"><a href="http://brettbeauregard.com/blog/2011/04/how-fast-is-the-arduino-pid-library/" rel="next">How Fast is the Arduino PID Library?</a> »</div>
		</div>

		<div class="post-1187 post type-post status-publish format-standard hentry category-coding category-pid tag-arduino tag-beginners-pid tag-pid" id="post-1187">
			<h2>Improving the Beginner’s PID: Direction</h2>

			<div class="entry">
				<p><small>(This is the last modification in a <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/improving-the-beginners-pid-introduction">larger series</a> on writing a solid PID algorithm)</small></p>
<h3>The Problem</h3>
<p>The processes the PID will be connected to fall into two groups: direct acting and reverse acting.  All the examples I’ve shown so far have been direct acting.  That is, an increase in the output causes an increase in the input. For reverse acting processes the opposite is true. In a refrigerator for example, an increase in cooling causes the temperature to go down. To make the beginner PID work with a reverse process, the signs of kp, ki, and kd all must be negative.</p>
<p>This isn’t a problem per se, but the user must choose the correct sign, and make sure that all the parameters have the same sign.</p>
<h3>The Solution</h3>
<p>To make the process a little simpler, I require that kp, ki, and kd all be &gt;=0.  If the user is connected to a reverse process, they specify that separately using the SetControllerDirection function.  this ensures that the parameters all have the same sign, and hopefully makes things more intuitive.</p>
<h3>The Code</h3>
<div><div id="highlighter_871186" class="syntaxhighlighter  css"><table border="0" cellpadding="0" cellspacing="0"><tbody><tr><td class="gutter"><div class="line number1 index0 alt2">1</div><div class="line number2 index1 alt1">2</div><div class="line number3 index2 alt2">3</div><div class="line number4 index3 alt1">4</div><div class="line number5 index4 alt2">5</div><div class="line number6 index5 alt1">6</div><div class="line number7 index6 alt2">7</div><div class="line number8 index7 alt1">8</div><div class="line number9 index8 alt2">9</div><div class="line number10 index9 alt1">10</div><div class="line number11 index10 alt2">11</div><div class="line number12 index11 alt1">12</div><div class="line number13 index12 alt2 highlighted">13</div><div class="line number14 index13 alt1 highlighted">14</div><div class="line number15 index14 alt2 highlighted">15</div><div class="line number16 index15 alt1">16</div><div class="line number17 index16 alt2">17</div><div class="line number18 index17 alt1">18</div><div class="line number19 index18 alt2">19</div><div class="line number20 index19 alt1">20</div><div class="line number21 index20 alt2">21</div><div class="line number22 index21 alt1">22</div><div class="line number23 index22 alt2">23</div><div class="line number24 index23 alt1">24</div><div class="line number25 index24 alt2">25</div><div class="line number26 index25 alt1">26</div><div class="line number27 index26 alt2">27</div><div class="line number28 index27 alt1">28</div><div class="line number29 index28 alt2">29</div><div class="line number30 index29 alt1">30</div><div class="line number31 index30 alt2">31</div><div class="line number32 index31 alt1">32</div><div class="line number33 index32 alt2">33</div><div class="line number34 index33 alt1">34</div><div class="line number35 index34 alt2">35</div><div class="line number36 index35 alt1">36</div><div class="line number37 index36 alt2">37</div><div class="line number38 index37 alt1">38</div><div class="line number39 index38 alt2">39</div><div class="line number40 index39 alt1">40</div><div class="line number41 index40 alt2">41</div><div class="line number42 index41 alt1">42</div><div class="line number43 index42 alt2">43</div><div class="line number44 index43 alt1 highlighted">44</div><div class="line number45 index44 alt2">45</div><div class="line number46 index45 alt1">46</div><div class="line number47 index46 alt2">47</div><div class="line number48 index47 alt1">48</div><div class="line number49 index48 alt2">49</div><div class="line number50 index49 alt1">50</div><div class="line number51 index50 alt2 highlighted">51</div><div class="line number52 index51 alt1 highlighted">52</div><div class="line number53 index52 alt2 highlighted">53</div><div class="line number54 index53 alt1 highlighted">54</div><div class="line number55 index54 alt2 highlighted">55</div><div class="line number56 index55 alt1 highlighted">56</div><div class="line number57 index56 alt2">57</div><div class="line number58 index57 alt1">58</div><div class="line number59 index58 alt2">59</div><div class="line number60 index59 alt1">60</div><div class="line number61 index60 alt2">61</div><div class="line number62 index61 alt1">62</div><div class="line number63 index62 alt2">63</div><div class="line number64 index63 alt1">64</div><div class="line number65 index64 alt2">65</div><div class="line number66 index65 alt1">66</div><div class="line number67 index66 alt2">67</div><div class="line number68 index67 alt1">68</div><div class="line number69 index68 alt2">69</div><div class="line number70 index69 alt1">70</div><div class="line number71 index70 alt2">71</div><div class="line number72 index71 alt1">72</div><div class="line number73 index72 alt2">73</div><div class="line number74 index73 alt1">74</div><div class="line number75 index74 alt2">75</div><div class="line number76 index75 alt1">76</div><div class="line number77 index76 alt2">77</div><div class="line number78 index77 alt1">78</div><div class="line number79 index78 alt2">79</div><div class="line number80 index79 alt1">80</div><div class="line number81 index80 alt2">81</div><div class="line number82 index81 alt1">82</div><div class="line number83 index82 alt2">83</div><div class="line number84 index83 alt1">84</div><div class="line number85 index84 alt2">85</div><div class="line number86 index85 alt1">86</div><div class="line number87 index86 alt2">87</div><div class="line number88 index87 alt1">88</div><div class="line number89 index88 alt2">89</div><div class="line number90 index89 alt1">90</div><div class="line number91 index90 alt2">91</div><div class="line number92 index91 alt1">92</div><div class="line number93 index92 alt2">93</div><div class="line number94 index93 alt1">94</div><div class="line number95 index94 alt2">95</div><div class="line number96 index95 alt1">96</div><div class="line number97 index96 alt2">97</div><div class="line number98 index97 alt1">98</div><div class="line number99 index98 alt2">99</div><div class="line number100 index99 alt1">100</div><div class="line number101 index100 alt2">101</div><div class="line number102 index101 alt1 highlighted">102</div><div class="line number103 index102 alt2 highlighted">103</div><div class="line number104 index103 alt1 highlighted">104</div><div class="line number105 index104 alt2 highlighted">105</div></td><td class="code"><div class="container"><div class="line number1 index0 alt2"><code class="css comments">/*working variables*/</code></div><div class="line number2 index1 alt1"><code class="css plain">unsigned long lastTime;</code></div><div class="line number3 index2 alt2"><code class="css value">double</code> <code class="css plain">Input, Output, Setpoint;</code></div><div class="line number4 index3 alt1"><code class="css value">double</code> <code class="css plain">ITerm, lastInput;</code></div><div class="line number5 index4 alt2"><code class="css value">double</code> <code class="css plain">kp, ki, kd;</code></div><div class="line number6 index5 alt1"><code class="css plain">int SampleTime = </code><code class="css value">1000</code><code class="css plain">; //</code><code class="css value">1</code> <code class="css plain">sec</code></div><div class="line number7 index6 alt2"><code class="css value">double</code> <code class="css plain">outMin, outMax;</code></div><div class="line number8 index7 alt1"><code class="css plain">bool inAuto = false;</code></div><div class="line number9 index8 alt2">&nbsp;</div><div class="line number10 index9 alt1"><code class="css value">#def</code><code class="css plain">ine MANUAL </code><code class="css value">0</code></div><div class="line number11 index10 alt2"><code class="css value">#def</code><code class="css plain">ine AUTOMATIC </code><code class="css value">1</code></div><div class="line number12 index11 alt1">&nbsp;</div><div class="line number13 index12 alt2 highlighted"><code class="css value">#def</code><code class="css plain">ine DIRECT </code><code class="css value">0</code></div><div class="line number14 index13 alt1 highlighted"><code class="css value">#def</code><code class="css plain">ine REVERSE </code><code class="css value">1</code></div><div class="line number15 index14 alt2 highlighted"><code class="css plain">int controllerDirection = DIRECT;</code></div><div class="line number16 index15 alt1">&nbsp;</div><div class="line number17 index16 alt2"><code class="css plain">void Compute()</code></div><div class="line number18 index17 alt1"><code class="css plain">{</code></div><div class="line number19 index18 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(!inAuto) return;</code></div><div class="line number20 index19 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">unsigned long now = millis();</code></div><div class="line number21 index20 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">int timeChange = (now - lastTime);</code></div><div class="line number22 index21 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(timeChange&gt;=SampleTime)</code></div><div class="line number23 index22 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">{</code></div><div class="line number24 index23 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Compute all the working error variables*/</code></div><div class="line number25 index24 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">error = Setpoint - Input;</code></div><div class="line number26 index25 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">ITerm+= (ki * error);</code></div><div class="line number27 index26 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(ITerm &gt; outMax) ITerm= outMax;</code></div><div class="line number28 index27 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">else if(ITerm &lt; outMin) ITerm= outMin;</code></div><div class="line number29 index28 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">dInput = (Input - lastInput);</code></div><div class="line number30 index29 alt1">&nbsp;</div><div class="line number31 index30 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Compute PID Output*/</code></div><div class="line number32 index31 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">Output = kp * error + ITerm- kd * dInput;</code></div><div class="line number33 index32 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(Output &gt; outMax) Output = outMax;</code></div><div class="line number34 index33 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">else if(Output &lt; outMin) Output = outMin;</code></div><div class="line number35 index34 alt2">&nbsp;</div><div class="line number36 index35 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css comments">/*Remember some variables for next time*/</code></div><div class="line number37 index36 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">lastInput = Input;</code></div><div class="line number38 index37 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">lastTime = now;</code></div><div class="line number39 index38 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number40 index39 alt1"><code class="css plain">}</code></div><div class="line number41 index40 alt2">&nbsp;</div><div class="line number42 index41 alt1"><code class="css plain">void SetTunings(</code><code class="css value">double</code> <code class="css plain">Kp, </code><code class="css value">double</code> <code class="css plain">Ki, </code><code class="css value">double</code> <code class="css plain">Kd)</code></div><div class="line number43 index42 alt2"><code class="css plain">{</code></div><div class="line number44 index43 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if (Kp&lt;</code><code class="css value">0</code> <code class="css plain">|| Ki&lt;</code><code class="css value">0</code><code class="css plain">|| Kd&lt;</code><code class="css value">0</code><code class="css plain">) return;</code></div><div class="line number45 index44 alt2">&nbsp;</div><div class="line number46 index45 alt1"><code class="css spaces">&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">SampleTimeInSec = ((</code><code class="css value">double</code><code class="css plain">)SampleTime)/</code><code class="css value">1000</code><code class="css plain">;</code></div><div class="line number47 index46 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">kp = Kp;</code></div><div class="line number48 index47 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">ki = Ki * SampleTimeInSec;</code></div><div class="line number49 index48 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">kd = Kd / SampleTimeInSec;</code></div><div class="line number50 index49 alt1">&nbsp;</div><div class="line number51 index50 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;</code><code class="css plain">if(controllerDirection ==REVERSE)</code></div><div class="line number52 index51 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">{</code></div><div class="line number53 index52 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">kp = (</code><code class="css value">0</code> <code class="css plain">- kp);</code></div><div class="line number54 index53 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">ki = (</code><code class="css value">0</code> <code class="css plain">- ki);</code></div><div class="line number55 index54 alt2 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">kd = (</code><code class="css value">0</code> <code class="css plain">- kd);</code></div><div class="line number56 index55 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number57 index56 alt2"><code class="css plain">}</code></div><div class="line number58 index57 alt1">&nbsp;</div><div class="line number59 index58 alt2"><code class="css plain">void SetSampleTime(int NewSampleTime)</code></div><div class="line number60 index59 alt1"><code class="css plain">{</code></div><div class="line number61 index60 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if (NewSampleTime &gt; </code><code class="css value">0</code><code class="css plain">)</code></div><div class="line number62 index61 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">{</code></div><div class="line number63 index62 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css value">double</code> <code class="css plain">ratio&nbsp; = (</code><code class="css value">double</code><code class="css plain">)NewSampleTime</code></div><div class="line number64 index63 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">/ (</code><code class="css value">double</code><code class="css plain">)SampleTime;</code></div><div class="line number65 index64 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">ki *= ratio;</code></div><div class="line number66 index65 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">kd /= ratio;</code></div><div class="line number67 index66 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">SampleTime = (unsigned long)NewSampleTime;</code></div><div class="line number68 index67 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number69 index68 alt2"><code class="css plain">}</code></div><div class="line number70 index69 alt1">&nbsp;</div><div class="line number71 index70 alt2"><code class="css plain">void SetOutputLimits(</code><code class="css value">double</code> <code class="css plain">Min, </code><code class="css value">double</code> <code class="css plain">Max)</code></div><div class="line number72 index71 alt1"><code class="css plain">{</code></div><div class="line number73 index72 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(Min &gt; Max) return;</code></div><div class="line number74 index73 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">outMin = Min;</code></div><div class="line number75 index74 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">outMax = Max;</code></div><div class="line number76 index75 alt1">&nbsp;</div><div class="line number77 index76 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(Output &gt; outMax) Output = outMax;</code></div><div class="line number78 index77 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">else if(Output &lt; outMin) Output = outMin;</code></div><div class="line number79 index78 alt2">&nbsp;</div><div class="line number80 index79 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(ITerm &gt; outMax) ITerm= outMax;</code></div><div class="line number81 index80 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">else if(ITerm &lt; outMin) ITerm= outMin;</code></div><div class="line number82 index81 alt1"><code class="css plain">}</code></div><div class="line number83 index82 alt2">&nbsp;</div><div class="line number84 index83 alt1"><code class="css plain">void SetMode(int Mode)</code></div><div class="line number85 index84 alt2"><code class="css plain">{</code></div><div class="line number86 index85 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">bool newAuto = (Mode == AUTOMATIC);</code></div><div class="line number87 index86 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(newAuto == !inAuto)</code></div><div class="line number88 index87 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">{&nbsp; </code><code class="css comments">/*we just went from manual to auto*/</code></div><div class="line number89 index88 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">Initialize();</code></div><div class="line number90 index89 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">}</code></div><div class="line number91 index90 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;&nbsp;</code><code class="css plain">inAuto = newAuto;</code></div><div class="line number92 index91 alt1"><code class="css plain">}</code></div><div class="line number93 index92 alt2">&nbsp;</div><div class="line number94 index93 alt1"><code class="css plain">void Initialize()</code></div><div class="line number95 index94 alt2"><code class="css plain">{</code></div><div class="line number96 index95 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">lastInput = Input;</code></div><div class="line number97 index96 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">ITerm = Output;</code></div><div class="line number98 index97 alt1"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">if(ITerm &gt; outMax) ITerm= outMax;</code></div><div class="line number99 index98 alt2"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">else if(ITerm &lt; outMin) ITerm= outMin;</code></div><div class="line number100 index99 alt1"><code class="css plain">}</code></div><div class="line number101 index100 alt2">&nbsp;</div><div class="line number102 index101 alt1 highlighted"><code class="css plain">void SetControllerDirection(int Direction)</code></div><div class="line number103 index102 alt2 highlighted"><code class="css plain">{</code></div><div class="line number104 index103 alt1 highlighted"><code class="css spaces">&nbsp;&nbsp;&nbsp;</code><code class="css plain">controllerDirection = Direction;</code></div><div class="line number105 index104 alt2 highlighted"><code class="css plain">}</code></div></div></td></tr></tbody></table></div></div>
<h2>PID COMPLETE</h2>
<p>And that about wraps it up.  We’ve turned “The Beginner’s PID” into the most robust controller I know how to make at this time.  For those readers that were looking for a detailed explanation of the PID Library, I hope you got what you came for.  For those of you writing your own PID, I hope you were able to glean a few ideas that save you some cycles down the road.</p>
<p>Two Final Notes:</p>
<ol>
<li>If something in this series looks wrong please let me know.  I may have missed something, or might just need to be clearer in my explanation.  Either way I’d like to know.</li>
<li>This is just a basic PID.  There are many other issues that I intentionally left out in the name of simplicity. Off the top of my head: feed forward, reset tiebacks, integer math, different pid forms, using velocity instead of position.  If there’s interest in having me explore these topics please let me know.</li>
</ol>
<p><a rel="license" href="http://creativecommons.org/licenses/by-sa/3.0/"><img style="border-width: 0" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/80x15.png" alt="Creative Commons License"></a></p>
<p class="wp-flattr-button"><a href="http://brettbeauregard.com/blog/?flattrss_redirect&amp;id=1187&amp;md5=8ef488661e4023c8160479e75df00e37" title="Flattr" target="_blank"><img src="./Improving the Beginner’s PID_ Direction « Project Blog_files/flattr-badge-large.png" alt="flattr this!"></a></p>
								<p>Tags: <a href="http://brettbeauregard.com/blog/tag/arduino/" rel="tag">Arduino</a>, <a href="http://brettbeauregard.com/blog/tag/beginners-pid/" rel="tag">Beginner's PID</a>, <a href="http://brettbeauregard.com/blog/tag/pid/" rel="tag">PID</a></p>
				<p class="postmetadata alt">
					<small>
						This entry was posted
												on Friday, April 15th, 2011 at 3:07 pm						and is filed under <a href="http://brettbeauregard.com/blog/category/pid/coding/" rel="category tag">Coding</a>, <a href="http://brettbeauregard.com/blog/category/pid/" rel="category tag">PID</a>.
						You can follow any responses to this entry through the <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/feed/">RSS 2.0</a> feed.

													You can <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/#respond">leave a response</a>, or <a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/trackback/" rel="trackback">trackback</a> from your own site.

						
					</small>
				</p>

			</div>
		</div>

	
<!-- You can start editing here. -->

	<h3 id="comments">92 Responses to “Improving the Beginner’s PID: Direction”</h3>

	<div class="navigation">
		<div class="alignleft"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-1/#comments">« Older Comments</a></div>
		<div class="alignright"></div>
	</div>

	<ol class="commentlist">
			<li class="comment even thread-even depth-1" id="comment-31794">
				<div id="div-comment-31794" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/b685f551e64bce8ab27fd2de0e25949f" srcset="http://2.gravatar.com/avatar/b685f551e64bce8ab27fd2de0e25949f?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Stefan Weber</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-31794">
			January 11, 2012 at 11:02 am</a>		</div>

		<p>Nice job ! Keep the good work up ! Have you thought of doing different controll approaches like IMC or predictive control ?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-31798">
				<div id="div-comment-31798" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-31798">
			January 11, 2012 at 11:31 am</a>		</div>

		<p>I have written an IMC controller (for fun) in the past, but I would consider that a “beginner” IMC;  not something I would want to give people as an example.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-32824">
				<div id="div-comment-32824" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/e3bb6f0e3852ba477d3fcbdba33f69be" srcset="http://2.gravatar.com/avatar/e3bb6f0e3852ba477d3fcbdba33f69be?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Aaron Newsome</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-32824">
			January 21, 2012 at 3:07 pm</a>		</div>

		<p>This is really incredible. I wish I would have found it a long time ago. I’m grateful to have finally stumbled upon some code and an explanation I can wrap my head around! Great job!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-33377">
				<div id="div-comment-33377" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/d311ef0c371eb893cc6cc26cd985736b" srcset="http://1.gravatar.com/avatar/d311ef0c371eb893cc6cc26cd985736b?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">wwwoholic</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-33377">
			January 29, 2012 at 8:34 pm</a>		</div>

		<p>Wouldn’t it be MUCH simpler to invert output in one place instead of fiddling with constants all over the program?</p>
<p>And on related note, every time SetSampleTime gets called you introduce an error (however small) to constant values. Why not keep values set by user and calculate “running” constants as you do in SetTunings.</p>
<p>Also, it would be nice to see time overflow problem fixed on these pages. For those who do not read responses <img draggable="false" class="emoji" alt="🙂" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1f642.png"></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-33378">
				<div id="div-comment-33378" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-33378">
			January 29, 2012 at 9:50 pm</a>		</div>

		<p>@wwwoholic thanks for the comments.</p>
<p>I’m not sure what you mean by inverting the output.  Make it negative?  This would work if I was using the velocity form, but just making the output -25 instead of 25 would not produce the desired effect.  At the very least this would require some modifications to the initialization code.  Another common way of doing the direction thing is to define error as PV-SP instead of SP-PV.  Maybe that’s what you meant? Also, I’m not sure what you mean by “all over the program.”  I make them negative in one place.  other than that all the code is the same.</p>
<p>Your SampleTime point is well taken.  I used placeholders for the tuning parameters because I foresaw a situation (adaptive tuning) where that function would be called repeatedly.  With the SampleTime, I just couldn’t see a time were that would be called over and over, so I decided the error risk was minor, and not worth the extra (albeit small) overhead addition.</p>
<p>It’s on my list to go through the series and update both the overflow and reset windup code.  With a day job and the ospid I haven’t been able to find the time.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-33929">
				<div id="div-comment-33929" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/d311ef0c371eb893cc6cc26cd985736b" srcset="http://1.gravatar.com/avatar/d311ef0c371eb893cc6cc26cd985736b?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">wwwoholic</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-33929">
			February 5, 2012 at 10:44 pm</a>		</div>

		<p>It has been long time since I’ve learned how PID works, so I am more than fuzzy on velocity or ideal or any other forms. However discrete form that you implementing quite easy to comprehend. Mathematically speaking negating all k constants is exactly the same as negating output<br>
Output = – (kp * error + ki * errSum – kd * dInput)<br>
Unless, of course, you meant something else when you wrote kp = (0 – kp);</p>
<p>However since you did not change the output limiting (lines 33, 34) and it will not work if you negate output then I guess you assumed Input, Output and Setpoint always be positive or zero.</p>
<p>In this case changing direction is usually done by:<br>
Output = outMax – Output<br>
and not by changing sign of constants.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-33935">
				<div id="div-comment-33935" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-33935">
			February 5, 2012 at 11:56 pm</a>		</div>

		<p>@wwwoholic. I get what you’re saying now.  That would certainly be mathematically equivalent.  I guess my style was to leave the Compute function as uncluttered as possible,  and sort of compartmentalize the direction code.<br>
  You could cerainly throw an if structure into the compute function to decide if you need to multiply by -1. Whatever you’re comfortable with.<br>
The ultimate goal of this series was to get people familiar with the intenals of the library to the point where they could say “well I’m going to do it THIS way.”  It looks like in your case I succeeded!  <img draggable="false" class="emoji" alt="😉" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1f609.png"></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-42968">
				<div id="div-comment-42968" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/b1c32d2aee79ae0561abd034851650d1" srcset="http://2.gravatar.com/avatar/b1c32d2aee79ae0561abd034851650d1?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">A</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-42968">
			April 15, 2012 at 11:21 pm</a>		</div>

		<p>This is a terrific explanation. Thanks a lot for putting so much time and care into this! I learned a lot.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-43147">
				<div id="div-comment-43147" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/fbd637f5e008bec90227c94eb67b0617" srcset="http://0.gravatar.com/avatar/fbd637f5e008bec90227c94eb67b0617?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://davepinasphotoworld.com/" rel="external nofollow" class="url">Dave</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-43147">
			April 16, 2012 at 5:53 pm</a>		</div>

		<p>Brett,<br>
   I’ve been reading your (Great job by the way!!!!) blog and I’m trying to understand how the PID with a relay works.  I want to fire a relay with a digital output at a set interval until the analog input reaches the setpoint at which time it goes into standby mode waiting for the analog signal to drop at which times this process repeats itself. </p>
<p>Do you have any ideas if your PID would work for this application?  And if so do you have a moment to write a short code example?</p>
<p>Thank you<br>
Dave<br>
<a href="mailto:dpina@jgmaclellan.com">dpina@jgmaclellan.com</a></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-44290">
				<div id="div-comment-44290" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/8cac15b2bc696eef094dd474b3bedf69" srcset="http://2.gravatar.com/avatar/8cac15b2bc696eef094dd474b3bedf69?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Kyle</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-44290">
			April 23, 2012 at 2:20 am</a>		</div>

		<p>This is a really great resource. I don’t actually program micro controllers but work with PLC and DCS systems, and this really helped give me a rough idea of what is going on inside the processor.</p>
<p>I found the examples and calculations done in college where useless, and we actually had vendors in when an instructor was giving lectures on PID algorithms using all calculus. The vendor was quick to inform the instructor that the methods being taught were not how controllers implement PID anymore.</p>
<p>Anyway this is definitely an awesome series, much appreciated.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-45788">
				<div id="div-comment-45788" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/302594116197e9fa8cef6e1ba8d23c4c" srcset="http://0.gravatar.com/avatar/302594116197e9fa8cef6e1ba8d23c4c?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.peterphrastus.com/" rel="external nofollow" class="url">Peter Jordan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-45788">
			April 30, 2012 at 8:17 am</a>		</div>

		<p>Brett, </p>
<p>Great explanation and code. I want to use PID for pH control in a hydroponics setup. However, there are two reagents involved, both of which have their own solenoid to dispense. I’m not sure how to relate the output to these two devices. As well, they will liekly hae a different effect on the process variable for the same on time interval. Very difficult to normalize this. Your assistance would be very much appreciated in terms of understanding how to apply the code.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-45789">
				<div id="div-comment-45789" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-45789">
			April 30, 2012 at 8:19 am</a>		</div>

		<p>@peter this a very involved (and highly interesting) topic.  I recommend re-posting on the diy-pid-control google group where it can be discussed as its own thread, rather than interspersed in these comments</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-46533">
				<div id="div-comment-46533" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/e1ee11b72ac56b55ee7ba2c99f2fa12d" srcset="http://2.gravatar.com/avatar/e1ee11b72ac56b55ee7ba2c99f2fa12d?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Alex</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-46533">
			May 4, 2012 at 9:08 am</a>		</div>

		<p>Awesomeness redefined !!! the best tutorial that I have seen for a long time .. Lots of respect..</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-48248">
				<div id="div-comment-48248" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/19c9f63336052e170325a22b3c43d6f6" srcset="http://1.gravatar.com/avatar/19c9f63336052e170325a22b3c43d6f6?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">jazz</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-48248">
			May 13, 2012 at 9:07 am</a>		</div>

		<p>@peter, the problem with ph control is that it is exponential ,you can’t use a solenoid valve for that. You must get real control valves with the right curve of the plug and seat,In industries we use a split range for the 2 control valves, the valve for acid uses 4..12 mA (0..50%) and the valve for alkaline is using 12..20mA(50..100%) this means by pH7 both valves are closed.<br>
google for micropak control valves<br>
Hopefully this gives you some ideas</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-48258">
				<div id="div-comment-48258" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-48258">
			May 13, 2012 at 11:18 am</a>		</div>

		<p>@jazz I’m not sure I agree with you on that.  4-20mA control valves are definitely more precise, but you can approximate an analog behavior by controlling how long the solenoid pulses over a given widow (similar to PWM, but slower)</p>
<p>we’ve been having a great conversation on the <a href="https://groups.google.com/forum/?fromgroups#!topic/diy-pid-control/Dnt--H8IUXU" rel="nofollow">diy-pid-control group</a>.  I’d love to hear your thoughts.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-49016">
				<div id="div-comment-49016" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/25fbd9e3f998b27136e5f97c83f103b1" srcset="http://2.gravatar.com/avatar/25fbd9e3f998b27136e5f97c83f103b1?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Tom</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-49016">
			May 17, 2012 at 12:16 pm</a>		</div>

		<p>Just to say, yes the advanced topics are of interest!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-49311">
				<div id="div-comment-49311" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1c0f8ad43bec6160d193eb0a1114b06f" srcset="http://1.gravatar.com/avatar/1c0f8ad43bec6160d193eb0a1114b06f?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brain</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-49311">
			May 18, 2012 at 6:52 pm</a>		</div>

		<p>Hey mate, first, as many others said, great work, and thanks for sharing it.<br>
Second, i have Arduino 1 installed, and although the PID library is working just fine, i have not been able to compile this code you’ve posted here, as i get: undefined reference to `setup’, and, undefined reference to `loop’, quite annoying it’s been actually, and i just don’t see where the problem is, don’t think is the code.</p>
<p>So anyway, if you happen to know the solution to my problem i’d very much appreciate it! cheers!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-49344">
				<div id="div-comment-49344" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-49344">
			May 18, 2012 at 9:48 pm</a>		</div>

		<p>@Brian all arduino programs must have “void loop()” and “void setup()” declared.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-49562">
				<div id="div-comment-49562" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1c0f8ad43bec6160d193eb0a1114b06f" srcset="http://1.gravatar.com/avatar/1c0f8ad43bec6160d193eb0a1114b06f?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brain</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-49562">
			May 19, 2012 at 7:01 pm</a>		</div>

		<p>yes! and say on the basic PID code you wrote void Compute() and void SetTunings(double Kp, double Ki, double Kd), which should be enough right?<br>
Yet it shows me that error. I really don’t know whats going on here…</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-51964">
				<div id="div-comment-51964" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/5b6a105bc881091133846b8ed71c5565" srcset="http://2.gravatar.com/avatar/5b6a105bc881091133846b8ed71c5565?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Mason</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-51964">
			May 29, 2012 at 3:38 pm</a>		</div>

		<p>This is excellent! Thanks for writing this. I work in state based control now and only had ever created PID to the level you begin with. Your tutorial helped me remember the basics and taught me some new tricks as well. Much appreciated!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-55082">
				<div id="div-comment-55082" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/745083d2b3005de1aa1ab1a6be404fa9" srcset="http://1.gravatar.com/avatar/745083d2b3005de1aa1ab1a6be404fa9?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Thomas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-55082">
			June 13, 2012 at 9:49 am</a>		</div>

		<p>Woohh, I’m deeply impressed!<br>
In 1975 I programmed a true direct digital control system on a real time computer as my master thesis. I could do individual PI PD P PID….<br>
Some of your solutions are quite familiar to me.<br>
This broght back a lot of memories. The Computer was a million time as big as the Ardurino bord today <img draggable="false" class="emoji" alt="🙂" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1f642.png"></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-55096">
				<div id="div-comment-55096" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/745083d2b3005de1aa1ab1a6be404fa9" srcset="http://1.gravatar.com/avatar/745083d2b3005de1aa1ab1a6be404fa9?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Thomas</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-55096">
			June 13, 2012 at 11:11 am</a>		</div>

		<p>…..and I had about 4500 lines of assembler code on punch cards. I guess not many people know how a punch card looks like today. The free memory of the computer was about 24kB so a bit smaller than the one on the Ardrino. The minimum cycle was 100ms. My challange was the time to access the 5MB disk drive during the cycle to read and store my calculated PID data. I could run up to 24 different PIDs including master slave configurations. The communication device was a Teletype…. At the end a got a “A+” rating :-)))</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-61676">
				<div id="div-comment-61676" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a2eca89d3f5a16ae846f501d0596116c" srcset="http://1.gravatar.com/avatar/a2eca89d3f5a16ae846f501d0596116c?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Steven</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-61676">
			July 10, 2012 at 6:34 pm</a>		</div>

		<p>WOW THANK YOU!  This is great!  Do your output limits still work if the input and output are negative?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-61784">
				<div id="div-comment-61784" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-61784">
			July 11, 2012 at 9:30 am</a>		</div>

		<p>Yup.  Should work fine</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-63632">
				<div id="div-comment-63632" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/d23ecb54cb32817e69722dbb5ec7a563" srcset="http://1.gravatar.com/avatar/d23ecb54cb32817e69722dbb5ec7a563?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">ShangTao Yan</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-63632">
			July 20, 2012 at 7:00 am</a>		</div>

		<p>Thanks very Much!!! A  nice job  i have nerver saw before.</p>
<p>But i still don’t how to use output to control a runing motor with arduino.</p>
<p>Could you give more detai Code ? Thanks again</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-64226">
				<div id="div-comment-64226" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/55155c2a5c5fa38806f305291fc54cd5" srcset="http://2.gravatar.com/avatar/55155c2a5c5fa38806f305291fc54cd5?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Seba</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-64226">
			July 23, 2012 at 3:13 pm</a>		</div>

		<p>Thanks for the guide! Things like this makes life easier for begginers!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-65315">
				<div id="div-comment-65315" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/d6cf3ab9e7d9457636eddc19d38658a5" srcset="http://1.gravatar.com/avatar/d6cf3ab9e7d9457636eddc19d38658a5?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Scott</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-65315">
			July 27, 2012 at 8:04 pm</a>		</div>

		<p>Thanks Brett. You did a real nice job with this (PID). I took an electrical engineering class in control theory and I assure you it was far less helpful (laplace transforms and partial fraction integration until I couldn’t stand it).</p>
<p>You have provided a relatively simple and understandable primer for PID and the code. This is very empowering. Nice work Brett.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-68316">
				<div id="div-comment-68316" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1b2d2007708c84e19ddade5a3b24cfca" srcset="http://1.gravatar.com/avatar/1b2d2007708c84e19ddade5a3b24cfca?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Caner</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-68316">
			August 10, 2012 at 9:09 am</a>		</div>

		<p>Please keep on writing you are just doing well.<br>
pleeeeeeeeaaaaaaaaaaseeeeeeeeeeeeeeee.</p>
<p>2. This is just a basic PID. There are many other issues that I intentionally left out in the name of simplicity. Off the top of my head: feed forward, reset tiebacks, integer math, different pid forms, using velocity instead of position. If there’s interest in having me explore these topics please let me know.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-68423">
				<div id="div-comment-68423" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/06da303b75f97a644624cbde8da91fb3" srcset="http://0.gravatar.com/avatar/06da303b75f97a644624cbde8da91fb3?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Divy</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-68423">
			August 11, 2012 at 2:58 am</a>		</div>

		<p>Bret,<br>
        Great Job !! Very well articulated, your tweaks are easy to comprehend.I’d love to see more of you on the topics you mentioned in the final notes of this series. <img draggable="false" class="emoji" alt="🙂" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/1f642.png"></p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-71888">
				<div id="div-comment-71888" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/27dfdb12549756846efdd1e54c83c102" srcset="http://2.gravatar.com/avatar/27dfdb12549756846efdd1e54c83c102?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Nicholas Spencer</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-71888">
			September 6, 2012 at 2:01 pm</a>		</div>

		<p>Thanks Brett,<br>
I was wondering, by changing to a Kp on error rather than on PV, along with the other nifty and, I believe proper, changes to the “ideal PID” loop do we need to change anything in the auto tune program you have as a companion to this? Or, is the autotune setup to work exactly with this algorithm?</p>
<p>Thanks again.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="comment-71889">
				<div id="div-comment-71889" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-71889">
			September 6, 2012 at 2:06 pm</a>		</div>

		<p>@nicholas, I’m not sure what you mean by Kp on PV.  the K<em>d</em> is on PV, not the Kp.</p>
<p>as far as the autotune goes,  I wrote it with this algorithm in mind, but there should be no difference between derivative on Error or Measurement as far as autotune is concerned.  there should be no setpoint changes during the auto-tuning process.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-75152">
				<div id="div-comment-75152" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/f5b31e0327444051c8e7d9c28ea1d73b" srcset="http://0.gravatar.com/avatar/f5b31e0327444051c8e7d9c28ea1d73b?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">max</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-75152">
			September 25, 2012 at 6:02 am</a>		</div>

		<p>Thank you for the PID library. I am a newbie and I have a simple question:<br>
how can you change the value of the PID parameters ki, kp, kd from outside the program? I mean, if you want to double the value of ki without stopping the loop, how this would be possible?<br>
Thanks, Max</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-80954">
				<div id="div-comment-80954" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/b6deb8754ebbc7d51398614e8318578b" srcset="http://2.gravatar.com/avatar/b6deb8754ebbc7d51398614e8318578b?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Kurt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-80954">
			October 25, 2012 at 1:28 pm</a>		</div>

		<p>Now I feel confident about the topic. You have helped me alot. Please continue this series and included further topics.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-81831">
				<div id="div-comment-81831" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/4931f0ac8ad529567c1128e4a1aba882" srcset="http://1.gravatar.com/avatar/4931f0ac8ad529567c1128e4a1aba882?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://www.diag.com/" rel="external nofollow" class="url">John Sloan</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-81831">
			October 30, 2012 at 4:52 pm</a>		</div>

		<p>Wanted to express my appreciation for this excellent series of articles. Control theory is not my area. But between these and Tim Wescott’s “PID without a PhD” I was able to cobble something together and make it work surprisingly well. Challenging since I couldn’t use floating point nor even integer multiply or divide. But with some magic to round towards zero, managed to make it all work with just shifts, adds, and subtracts. Thanks again!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-83969">
				<div id="div-comment-83969" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/c31b061bf4f5420d0b99b2a80e4cb5a5" srcset="http://0.gravatar.com/avatar/c31b061bf4f5420d0b99b2a80e4cb5a5?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Alex</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-83969">
			November 9, 2012 at 11:55 am</a>		</div>

		<p>Brett,</p>
<p>This is very good.  Thanks for sharing!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-99525">
				<div id="div-comment-99525" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/19c5b3ddfcdba318494c1d6bf480e049" srcset="http://1.gravatar.com/avatar/19c5b3ddfcdba318494c1d6bf480e049?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Mike</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-99525">
			January 13, 2013 at 4:23 pm</a>		</div>

		<p>Awesome description, thanks for writing it!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-158632">
				<div id="div-comment-158632" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/6c2628ff9f147311c4810d2770f1f098" srcset="http://0.gravatar.com/avatar/6c2628ff9f147311c4810d2770f1f098?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Enver</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-158632">
			September 10, 2013 at 11:04 am</a>		</div>

		<p>Hi! </p>
<p>First i just want to say thanks for your work, have been using this for controlling a quadrotor with FY-901. The FY-901 is a stabilisatorn that isn’t as good as it should be. </p>
<p>My next project is to build PID controll for four engines. As you can guess, these engines are a part of a quadrotor. My problem is that i don’t know anything about multi PIDs which i think i will be needing. So i’m wounder if you know anything about this ? </p>
<p>Thanks in advance!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-159405">
				<div id="div-comment-159405" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/dae24ea0b8aa467e4526a61cafb67478" srcset="http://1.gravatar.com/avatar/dae24ea0b8aa467e4526a61cafb67478?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn"><a href="http://easternstargeek.blogspot.com/" rel="external nofollow" class="url">Daniel</a></cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-159405">
			September 11, 2013 at 4:08 pm</a>		</div>

		<p>Brett:</p>
<p>Outstanding job, not only on the elegant code implementation, but on the excellent explanations.  I have designed quite a bit of instructional material in my day, but yours is some of the best I have ever seen.  Bravo!</p>
<p>That said, I would love to see feed-forward implemented.  I think it is the most useful of all the “extras” you mentioned.</p>
<p>Thank you, and do keep up the good work!</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-160979">
				<div id="div-comment-160979" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/66a46d28a54837ba8a723403ecc4367e" srcset="http://0.gravatar.com/avatar/66a46d28a54837ba8a723403ecc4367e?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">John</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-160979">
			September 14, 2013 at 2:15 pm</a>		</div>

		<p>Thanks Brett!  This is an awesome tutorial.  I’m sure it took you a lot of time to write, but it has and will continue to help lots of us beginners.</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment odd alt thread-odd thread-alt depth-1" id="comment-164538">
				<div id="div-comment-164538" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/e56078ddfdec9907e8a2746d430e61bc" srcset="http://2.gravatar.com/avatar/e56078ddfdec9907e8a2746d430e61bc?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Chris</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-164538">
			September 20, 2013 at 3:18 pm</a>		</div>

		<p>Hi,</p>
<p>Great program! I wonder if anyone has had a problem with sporatic NaN output. Sometimes it happens after a hundred data points and sometimes it runs through tens of thousands of data points without producing NaN. I suspect it may have to do with the ms timer, but I have no way to access that variable because I am using the Arduino library and not running a C compiler. Once I get NaN all subsequent values are NaN. Anyone have any ideas?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment even thread-even depth-1" id="comment-184634">
				<div id="div-comment-184634" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/155983efa59af993411f95cb01af1856" srcset="http://1.gravatar.com/avatar/155983efa59af993411f95cb01af1856?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Matt</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-184634">
			April 9, 2016 at 7:30 pm</a>		</div>

		<p>Great tutorial!</p>
<p>I have one question. For using velocity instead of position, do I need to change a code and PID math, or I can use the same library?</p>

		
				</div>
		</li><!-- #comment-## -->
		<li class="comment byuser comment-author-admin bypostauthor odd alt thread-odd thread-alt depth-1" id="comment-185498">
				<div id="div-comment-185498" class="comment-body">
				<div class="comment-author vcard">
			<img alt="" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/a549e72ed66e1c1e512afcc0f8c14f51" srcset="http://1.gravatar.com/avatar/a549e72ed66e1c1e512afcc0f8c14f51?s=64&amp;d=mm&amp;r=g 2x" class="avatar avatar-32 photo" height="32" width="32">			<cite class="fn">Brett</cite> <span class="says">says:</span>		</div>
		
		<div class="comment-meta commentmetadata"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-2/#comment-185498">
			April 14, 2016 at 8:38 am</a>		</div>

		<p>@Matt,  so we’re clear, you’re talking about controlling the velocity of something vs. the position of something?  I ask because there are also different pid algorithm implementations with those names.  assuming that you’re controlling the velocity of a robot, say, then yes, this algorithm is fine.  it doesn’t care what the actual process is.  it’s just trying to make the Input variable equal the Setpoint Variable by adjusting the Output variable.</p>

		
				</div>
		</li><!-- #comment-## -->
	</ol>

	<div class="navigation">
		<div class="alignleft"><a href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/comment-page-1/#comments">« Older Comments</a></div>
		<div class="alignright"></div>
	</div>
 


<div id="respond">

<h3>Leave a Reply</h3>

<div class="cancel-comment-reply">
	<small><a rel="nofollow" id="cancel-comment-reply-link" href="http://brettbeauregard.com/blog/2011/04/improving-the-beginners-pid-direction/#respond" style="display:none;">Click here to cancel reply.</a></small>
</div>


<form action="http://brettbeauregard.com/blog/wp-comments-post.php" method="post" id="commentform">


<p><input type="text" name="author" id="author" value="" size="22" tabindex="1" aria-required="true">
<label for="author"><small>Name (required)</small></label></p>

<p><input type="text" name="email" id="email" value="" size="22" tabindex="2" aria-required="true">
<label for="email"><small>Mail (will not be published) (required)</small></label></p>

<p><input type="text" name="url" id="url" value="" size="22" tabindex="3">
<label for="url"><small>Website</small></label></p>


<!--<p><small><strong>XHTML:</strong> You can use these tags: <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;s&gt; &lt;strike&gt; &lt;strong&gt; </code></small></p>-->

<p><textarea name="comment" id="comment" cols="100%" rows="10" tabindex="4"></textarea></p>

<p><input name="submit" type="submit" id="submit" tabindex="5" value="Submit Comment">
<input type="hidden" name="comment_post_ID" value="1187" id="comment_post_ID">
<input type="hidden" name="comment_parent" id="comment_parent" value="0">
</p>
<p style="display: none;"><input type="hidden" id="akismet_comment_nonce" name="akismet_comment_nonce" value="8d5a085f87"></p>
</form>

</div>


	
	</div>
 	<div id="sidebar">
		<ul>
						<li>
				<form role="search" method="get" id="searchform" class="searchform" action="http://brettbeauregard.com/blog/">
				<div>
					<label class="screen-reader-text" for="s">Search for:</label>
					<input type="text" value="" name="s" id="s">
					<input type="submit" id="searchsubmit" value="Search">
				</div>
			</form>			</li>

			<!-- Author information is disabled per default. Uncomment and fill in your details if you want to use it.
			<li><h2>Author</h2>
			<p>A little something about you, the author. Nothing lengthy, just an overview.</p>
			</li>
			-->

			
		

			
				<li id="linkcat-3" class="linkcat"><h2>Links</h2>
	<ul class="xoxo blogroll">
<li><a href="http://groups.google.com/group/diy-pid-control/" title="PID Control Google Group"><img src="./Improving the Beginner’s PID_ Direction « Project Blog_files/diy-pid-control-link.jpg" alt="DIY PID Control" title="PID Control Google Group"></a></li>
<li><a href="http://www.ospid.com/blog/" title="osPID: The Open-Source PID controller"><img src="./Improving the Beginner’s PID_ Direction « Project Blog_files/osPID-Link.jpg" alt="osPID" title="osPID: The Open-Source PID controller"></a></li>
<li><a href="http://www.thingiverse.com/br3ttb" title="My Thingiverse Profile"><img src="./Improving the Beginner’s PID_ Direction « Project Blog_files/printed_portrait-small.jpg" alt="Thingiverse Profile" title="My Thingiverse Profile"></a></li>

	</ul>
</li>
<li id="linkcat-8" class="linkcat"><h2>This Site</h2>
	<ul class="xoxo blogroll">
<li><a href="http://brettbeauregard.com/about.html">About</a></li>
<li><a href="http://brettbeauregard.com/projects/" rel="me">Project Index</a></li>

	</ul>
</li>

	
			

			<li class="categories"><h2>Categories</h2><ul>	<li class="cat-item cat-item-7"><a href="http://brettbeauregard.com/blog/category/pid/">PID</a> (25)
<ul class="children">
	<li class="cat-item cat-item-31"><a href="http://brettbeauregard.com/blog/category/pid/coding/">Coding</a> (12)
</li>
	<li class="cat-item cat-item-33"><a href="http://brettbeauregard.com/blog/category/pid/front-end/">Front End</a> (2)
</li>
	<li class="cat-item cat-item-35"><a href="http://brettbeauregard.com/blog/category/pid/showcase/">Showcase</a> (4)
</li>
</ul>
</li>
	<li class="cat-item cat-item-5"><a href="http://brettbeauregard.com/blog/category/projects/">Projects</a> (40)
<ul class="children">
	<li class="cat-item cat-item-19"><a href="http://brettbeauregard.com/blog/category/projects/craft/">Craft</a> (6)
</li>
	<li class="cat-item cat-item-16"><a href="http://brettbeauregard.com/blog/category/projects/electronic/">Electronic</a> (12)
</li>
	<li class="cat-item cat-item-17"><a href="http://brettbeauregard.com/blog/category/projects/mechanical/">Mechanical</a> (26)
</li>
</ul>
</li>
	<li class="cat-item cat-item-1"><a href="http://brettbeauregard.com/blog/category/uncategorized/">Uncategorized</a> (4)
</li>
</ul></li><li><h2>Archives</h2>
				<ul>
					<li><a href="http://brettbeauregard.com/blog/2017/06/">June 2017</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/11/">November 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/09/">September 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/07/">July 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/06/">June 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/04/">April 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/03/">March 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2012/01/">January 2012</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/12/">December 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/10/">October 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/09/">September 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/08/">August 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/07/">July 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/06/">June 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/05/">May 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2011/04/">April 2011</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/09/">September 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/08/">August 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/07/">July 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2010/03/">March 2010</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/11/">November 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/10/">October 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/09/">September 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/08/">August 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/07/">July 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/06/">June 2009</a></li>
	<li><a href="http://brettbeauregard.com/blog/2009/05/">May 2009</a></li>
				</ul>
			</li>
					</ul>
	</div>
<hr>
<div id="footer">
<!-- If you'd like to support WordPress, having the "powered by" link somewhere on your blog is the best way; it's our only promotion or advertising. -->
	<p>
		Project  Blog is proudly powered by
		<a href="http://wordpress.org/">WordPress</a>
		<br><a href="http://brettbeauregard.com/blog/feed/">Entries (RSS)</a>
		and <a href="http://brettbeauregard.com/blog/comments/feed/">Comments (RSS)</a>.
		<!-- 28 queries. 0.382 seconds. -->
	</p>
</div>
</div>

<!-- Gorgeous design by Michael Heilemann - http://binarybonsai.com/kubrick/ -->

		<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/shCore.js.download"></script>
<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/shBrushCss.js.download"></script>
<script type="text/javascript">
	(function(){
		var corecss = document.createElement('link');
		var themecss = document.createElement('link');
		var corecssurl = "http://brettbeauregard.com/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shCore.css?ver=3.0.83c";
		if ( corecss.setAttribute ) {
				corecss.setAttribute( "rel", "stylesheet" );
				corecss.setAttribute( "type", "text/css" );
				corecss.setAttribute( "href", corecssurl );
		} else {
				corecss.rel = "stylesheet";
				corecss.href = corecssurl;
		}
		document.getElementsByTagName("head")[0].insertBefore( corecss, document.getElementById("syntaxhighlighteranchor") );
		var themecssurl = "http://brettbeauregard.com/blog/wp-content/plugins/syntaxhighlighter/syntaxhighlighter3/styles/shThemeDefault.css?ver=3.0.83c";
		if ( themecss.setAttribute ) {
				themecss.setAttribute( "rel", "stylesheet" );
				themecss.setAttribute( "type", "text/css" );
				themecss.setAttribute( "href", themecssurl );
		} else {
				themecss.rel = "stylesheet";
				themecss.href = themecssurl;
		}
		//document.getElementById("syntaxhighlighteranchor").appendChild(themecss);
		document.getElementsByTagName("head")[0].insertBefore( themecss, document.getElementById("syntaxhighlighteranchor") );
	})();
	SyntaxHighlighter.config.strings.expandSource = '+ expand source';
	SyntaxHighlighter.config.strings.help = '?';
	SyntaxHighlighter.config.strings.alert = 'SyntaxHighlighter\n\n';
	SyntaxHighlighter.config.strings.noBrush = 'Can\'t find brush for: ';
	SyntaxHighlighter.config.strings.brushNotHtmlScript = 'Brush wasn\'t configured for html-script option: ';
	SyntaxHighlighter.defaults['gutter'] = false;
	SyntaxHighlighter.defaults['pad-line-numbers'] = false;
	SyntaxHighlighter.defaults['toolbar'] = false;
	SyntaxHighlighter.defaults['wrap-lines'] = false;
	SyntaxHighlighter.all();
</script>
<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/comment-reply.min.js.download"></script>
<script type="text/javascript" src="./Improving the Beginner’s PID_ Direction « Project Blog_files/wp-embed.min.js.download"></script>


</body></html>